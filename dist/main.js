(()=>{"use strict";const e=e=>{let t=0;return{hit:function(){t+=1},isSunk:function(){return e<=t},length:e,getHits:()=>t}},t=e=>({type:e,gameboard:(e=>{const t=function(){const e=[];for(let t=0;t<=9;t++){e[t]=[];for(let o=0;o<=9;o++)e[t][o]=""}return e}(),o=[];function a(e){return!(e<0||e>9)}function n(e,o){const a=[t[e+1]?.[o],t[e-1]?.[o],t[e]?.[o+1],t[e]?.[o-1],t[e+1]?.[o+1],t[e-1]?.[o-1],t[e-1]?.[o+1],t[e+1]?.[o-1]];for(let e=0;e<a.length;e++)if(a[e]&&"O"===a[e].value)return!0;return!1}function r(){let t=0;for(let e of o)!0===e.isSunk&&t++;if(console.log(t),t>=10)return(e=>{const t=document.querySelector(".modal"),o=document.querySelector(".overlay");return document.querySelector(".btn").addEventListener("click",(()=>{t.classList.add("hidden"),o.classList.add("hidden"),location.reload()})),{openModal:function(){document.querySelector(".win").textContent=`${e} lost!`,t.classList.remove("hidden"),o.classList.remove("hidden")}}})(`${e}`).openModal(),console.log(`${e} lose`),!0}return{gameboard:t,placeShip:function(e,r,d,l){if(!a(e)||!a(r)||n(e,r))return 2;if("vertical"===l&&a(e+d.length-1)&&!n(e+d.length-1,r))for(let a=e;a<e+d.length;a++){if(""!==t[a][r])return 2;t[a][r]={type:`${d.length}ship`,ship:d,value:"O",isSunk:!1},o.push(t[a][r])}else{if("horizontal"!==l||!a(r+d.length-1)||n(e,r+d.length-1))return 2;for(let a=r;a<r+d.length;a++){if(""!==t[e][a])return 2;t[e][a]={type:`${d.length}ship`,ship:d,value:"O",isSunk:!1},o.push(t[e][a])}}return t},receiveAttack:function(e,o){if(!a(e)||!a(o)||!0===r())return console.log("Attack out of board");{let a=t[e][o];if("●"===a)return;""===a?(t[e][o]="●",console.log("Miss")):"O"===a.value&&(a.ship.hit(),a.value="X",a.ship.isSunk()&&(a.isSunk=!0,console.log("Sunk")),console.log(a.isSunk),r())}},checkEndGame:r}})(e)});let o;document.addEventListener("DOMContentLoaded",(()=>{!function(){const a=document.querySelector(".gameboard-one"),n=document.querySelector(".gameboard-two"),r=t("You"),d=t("Computer"),l=[e(4),e(3),e(3),e(2),e(2),e(2),e(1),e(1),e(1),e(1)];function i(e){l.forEach((t=>{let o=!1;for(;!o;){let a=Math.random()<.5?"horizontal":"vertical",n=Math.floor(10*Math.random()),r=Math.floor(10*Math.random());2!==e.gameboard.placeShip(n,r,t,a)&&(o=!0)}}))}i(r),i(d),o=function(e,t){const o=document.createElement("div");function a(){o.textContent="";for(let t=0;t<e.gameboard.gameboard.length;t++)for(let a=0;a<e.gameboard.gameboard[t].length;a++){const n=document.createElement("div");"object"==typeof e.gameboard.gameboard[t][a]?(e.gameboard.gameboard[t][a].value="O")&&(n.innerHTML=e.gameboard.gameboard[t][a].value,n.classList.add("black")):"X"===e.gameboard.gameboard[t][a]?(n.innerHTML=e.gameboard.gameboard[t][a],n.classList.add("orange")):n.innerHTML=e.gameboard.gameboard[t][a],o.appendChild(n)}t.append(o)}return o.classList.add("container"),{render:a,attack:function t(o=0){if(o>=99)return void console.log("Maximum attempts reached. Exiting attack function.");let n=Math.floor(10*Math.random()),r=Math.floor(10*Math.random());if("●"!==e.gameboard.gameboard[n][r]&&"X"!==e.gameboard.gameboard[n][r].value&&"X"!==e.gameboard.gameboard[n][r])return e.gameboard.receiveAttack(n,r),"object"==typeof e.gameboard.gameboard[n][r]?(e.gameboard.gameboard[n][r]=e.gameboard.gameboard[n][r].value,setTimeout(t,1e3),void a()):void a();t(o+1)}}}(r,a),function(e,t){const a=document.createElement("div");a.classList.add("container");for(let t=0;t<e.gameboard.gameboard.length;t++)for(let n=0;n<e.gameboard.gameboard[t].length;n++){const r=document.createElement("div");a.appendChild(r),r.addEventListener("click",(()=>{e.gameboard.receiveAttack([t],[n]),"object"==typeof e.gameboard.gameboard[t][n]?(r.innerHTML=e.gameboard.gameboard[t][n].value,r.classList.add("orange")):(r.innerHTML=e.gameboard.gameboard[t][n],setTimeout(o.attack,1e3),o.render())}))}t.append(a)}(d,n),o.render()}()}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsIm1hcHBpbmdzIjoibUJBQUEsTUFBTUEsRUFBUUMsSUFFWixJQUFJQyxFQUFPLEVBWVgsTUFBTyxDQUNMQyxJQVhGLFdBQ0VELEdBQVEsQ0FDVixFQVVFRSxPQVJGLFdBQ0UsT0FBSUgsR0FBY0MsQ0FHcEIsRUFLRUcsT0FoQmFKLEVBaUJiSyxRQUFTLElBQU1KLEVBQ2hCLEVDakJHSyxFQUFVQyxJQUtMLENBQ0hDLEtBTFNELEVBTVRFLFVDTlUsQ0FBQ0MsSUFZakIsTUFBTUQsRUFYTixXQUNFLE1BQU1FLEVBQVksR0FDbEIsSUFBSyxJQUFJQyxFQUFJLEVBQUdBLEdBQUssRUFBR0EsSUFBSyxDQUMzQkQsRUFBVUMsR0FBSyxHQUNmLElBQUssSUFBSUMsRUFBSSxFQUFHQSxHQUFLLEVBQUdBLElBQ3RCRixFQUFVQyxHQUFHQyxHQUFLLEVBRXRCLENBQ0EsT0FBT0YsQ0FDVCxDQUVrQkcsR0FDWkMsRUFBUSxHQUVkLFNBQVNDLEVBQWdCQyxHQUN2QixRQUFJQSxFQUFRLEdBQUtBLEVBQVEsRUFLM0IsQ0ErREEsU0FBU0MsRUFBa0JDLEVBQUtDLEdBQzlCLE1BQU1DLEVBQWEsQ0FDakJaLEVBQVVVLEVBQU0sS0FBS0MsR0FDckJYLEVBQVVVLEVBQU0sS0FBS0MsR0FDckJYLEVBQVVVLEtBQU9DLEVBQU0sR0FDdkJYLEVBQVVVLEtBQU9DLEVBQU0sR0FDdkJYLEVBQVVVLEVBQU0sS0FBS0MsRUFBTSxHQUMzQlgsRUFBVVUsRUFBTSxLQUFLQyxFQUFNLEdBQzNCWCxFQUFVVSxFQUFNLEtBQUtDLEVBQU0sR0FDM0JYLEVBQVVVLEVBQU0sS0FBS0MsRUFBTSxJQUc3QixJQUFLLElBQUlSLEVBQUksRUFBR0EsRUFBSVMsRUFBV2pCLE9BQVFRLElBQ3JDLEdBQUlTLEVBQVdULElBQThCLE1BQXhCUyxFQUFXVCxHQUFHVSxNQUNqQyxPQUFPLEVBR2IsT0FBTyxDQUNULENBc0RFLFNBQVNDLElBQ1AsSUFBSUMsRUFBVSxFQUNkLElBQUssSUFBSUMsS0FBUVYsR0FDSyxJQUFoQlUsRUFBS3RCLFFBQ1BxQixJQUlKLEdBREFFLFFBQVFDLElBQUlILEdBQ1JBLEdBQVcsR0FJYixNQzFFUSxDQUFDSSxJQUNYLE1BQU1DLEVBQVFDLFNBQVNDLGNBQWMsVUFDL0JDLEVBQVVGLFNBQVNDLGNBQWMsWUFvQnZDLE9BbkJtQkQsU0FBU0MsY0FBYyxRQUMvQkUsaUJBQWlCLFNBQVMsS0FhakNKLEVBQU1LLFVBQVVDLElBQUksVUFDcEJILEVBQVFFLFVBQVVDLElBQUksVUFDdEJDLFNBQVNDLFFBZEUsSUFpQlIsQ0FBQ0MsVUFiUixXQUN1QlIsU0FBU0MsY0FBYyxRQUMvQlEsWUFBYyxHQUFHWCxVQUM1QkMsRUFBTUssVUFBVU0sT0FBTyxVQUN2QlIsRUFBUUUsVUFBVU0sT0FBTyxTQUM3QixFQVFpQixFRGlETFgsQ0FBTSxHQUFHbkIsS0FDZDRCLFlBQ0xaLFFBQVFDLElBQUksR0FBR2pCLFdBQ1IsQ0FFWCxDQUVBLE1BQU8sQ0FDTEQsWUFDQWdDLFVBckpGLFNBQW1CdEIsRUFBS0MsRUFBS0ssRUFBTWlCLEdBQ2pDLElBQUkxQixFQUFnQkcsS0FBUUgsRUFBZ0JJLElBQVNGLEVBQWtCQyxFQUFLQyxHQTBCckUsT0FBTyxFQXpCVixHQUFrQixhQUFkc0IsR0FBNEIxQixFQUFnQkcsRUFBTU0sRUFBS3JCLE9BQVMsS0FBS2MsRUFBa0JDLEVBQU1NLEVBQUtyQixPQUFTLEVBQUdnQixHQUM5RyxJQUFLLElBQUlSLEVBQUlPLEVBQUtQLEVBQUlPLEVBQU1NLEVBQUtyQixPQUFRUSxJQUFLLENBQzFDLEdBQTBCLEtBQXRCSCxFQUFVRyxHQUFHUSxHQVFWLE9BQU8sRUFQVlgsRUFBVUcsR0FBR1EsR0FBTyxDQUNoQlosS0FBTSxHQUFHaUIsRUFBS3JCLGFBQ2RxQixLQUFNQSxFQUNOSCxNQUFPLElBQ1BuQixRQUFRLEdBRVpZLEVBQU00QixLQUFLbEMsRUFBVUcsR0FBR1EsR0FFaEMsS0FDRyxJQUFrQixlQUFkc0IsSUFBOEIxQixFQUFnQkksRUFBTUssRUFBS3JCLE9BQVMsSUFBS2MsRUFBa0JDLEVBQUtDLEVBQU1LLEVBQUtyQixPQUFTLEdBWXRILE9BQU8sRUFYVixJQUFLLElBQUlRLEVBQUlRLEVBQUtSLEVBQUlRLEVBQU1LLEVBQUtyQixPQUFRUSxJQUFLLENBQzFDLEdBQTBCLEtBQXRCSCxFQUFVVSxHQUFLUCxHQVFaLE9BQU8sRUFQVkgsRUFBVVUsR0FBS1AsR0FBSyxDQUNoQkosS0FBTSxHQUFHaUIsRUFBS3JCLGFBQ2RxQixLQUFNQSxFQUNOSCxNQUFPLElBQ1BuQixRQUFRLEdBRVpZLEVBQU00QixLQUFLbEMsRUFBVVUsR0FBS1AsR0FFbEMsQ0FDVyxDQUduQixPQUFPSCxDQUNYLEVBd0hJbUMsY0FuSEYsU0FBdUJ6QixFQUFLQyxHQUMxQixJQUFJSixFQUFnQkcsS0FBUUgsRUFBZ0JJLEtBQXlCLElBQW5CRyxJQW1CaEQsT0FBT0csUUFBUUMsSUFBSSx1QkFuQnNELENBQ3pFLElBQUlrQixFQUFZcEMsRUFBVVUsR0FBS0MsR0FDL0IsR0FBa0IsTUFBZHlCLEVBQ0YsT0FDdUIsS0FBZEEsR0FDVHBDLEVBQVVVLEdBQUtDLEdBQU8sSUFDdEJNLFFBQVFDLElBQUksU0FDaUIsTUFBcEJrQixFQUFVdkIsUUFDbkJ1QixFQUFVcEIsS0FBS3ZCLE1BQ2YyQyxFQUFVdkIsTUFBUSxJQUNkdUIsRUFBVXBCLEtBQUt0QixXQUNqQjBDLEVBQVUxQyxRQUFTLEVBRW5CdUIsUUFBUUMsSUFBSSxTQUVkRCxRQUFRQyxJQUFJa0IsRUFBVTFDLFFBQ3RCb0IsSUFFSixDQUdGLEVBOEZFQSxlQUNELEVEL0ttQnVCLENBQVV2QyxLR0RoQyxJQUFJd0MsRUNGSmpCLFNBQVNHLGlCQUFpQixvQkFBb0IsTURHOUMsV0FDSSxNQUFNZSxFQUFpQmxCLFNBQVNDLGNBQWMsa0JBQ3hDa0IsRUFBbUJuQixTQUFTQyxjQUFjLGtCQUUxQ21CLEVBQWE1QyxFQUFPLE9BQ3BCNkMsRUFBYTdDLEVBQU8sWUFhcEJTLEVBQVEsQ0FYR2hCLEVBQUssR0FDREEsRUFBSyxHQUNMQSxFQUFLLEdBQ1BBLEVBQUssR0FDTEEsRUFBSyxHQUNIQSxFQUFLLEdBQ1BBLEVBQUssR0FDTEEsRUFBSyxHQUNIQSxFQUFLLEdBQ05BLEVBQUssSUFrQnpCLFNBQVNxRCxFQUFXM0MsR0FLaEJNLEVBQU1zQyxTQUFTNUIsSUFDWCxJQUFJNkIsR0FBYSxFQUNqQixNQUFRQSxHQUFZLENBQ2hCLElBQUlDLEVBckJMQyxLQUFLQyxTQUFXLEdBY0osYUFDRixXQU9MdEMsRUFBTXFDLEtBQUtFLE1BQXNCLEdBQWhCRixLQUFLQyxVQUN0QnJDLEVBQU1vQyxLQUFLRSxNQUFzQixHQUFoQkYsS0FBS0MsVUFFWCxJQURGaEQsRUFBVUEsVUFBVWdDLFVBQVV0QixFQUFLQyxFQUFLSyxFQUFNOEIsS0FFdkRELEdBQWEsRUFFckIsSUFFUixDQUdBRixFQUFXRixHQUNYRSxFQUFXRCxHQXdCWEosRURsRkosU0FBK0JyQyxFQUFRaUQsR0FDbkMsTUFBTUMsRUFBWTlCLFNBQVMrQixjQUFjLE9BRXpDLFNBQVNDLElBQ0xGLEVBQVVyQixZQUFjLEdBQ3hCLElBQUssSUFBSTNCLEVBQUksRUFBR0EsRUFBSUYsRUFBT0QsVUFBVUEsVUFBVUwsT0FBUVEsSUFDbkQsSUFBSyxJQUFJQyxFQUFJLEVBQUdBLEVBQUlILEVBQU9ELFVBQVVBLFVBQVVHLEdBQUdSLE9BQVFTLElBQUssQ0FDM0QsTUFBTWtELEVBQVNqQyxTQUFTK0IsY0FBYyxPQUNVLGlCQUF0Q25ELEVBQU9ELFVBQVVBLFVBQVVHLEdBQUdDLElBQ2pDSCxFQUFPRCxVQUFVQSxVQUFVRyxHQUFHQyxHQUFHUyxNQUFRLE9BQ3hDeUMsRUFBT0MsVUFBWXRELEVBQU9ELFVBQVVBLFVBQVVHLEdBQUdDLEdBQUdTLE1BQ3BEeUMsRUFBTzdCLFVBQVVDLElBQUksVUFFbUIsTUFBckN6QixFQUFPRCxVQUFVQSxVQUFVRyxHQUFHQyxJQUNyQ2tELEVBQU9DLFVBQVl0RCxFQUFPRCxVQUFVQSxVQUFVRyxHQUFHQyxHQUNqRGtELEVBQU83QixVQUFVQyxJQUFJLFdBR3JCNEIsRUFBT0MsVUFBWXRELEVBQU9ELFVBQVVBLFVBQVVHLEdBQUdDLEdBRXJEK0MsRUFBVUssWUFBWUYsRUFDMUIsQ0FFSkosRUFBSU8sT0FBT04sRUFDZixDQWtDQSxPQXhEQUEsRUFBVTFCLFVBQVVDLElBQUksYUF3RGpCLENBQ0gyQixTQUNBSyxPQWhDSixTQUFTQSxFQUFPQyxFQUFVLEdBQ3RCLEdBQUlBLEdBSGEsR0FLYixZQURBMUMsUUFBUUMsSUFBSSxzREFJaEIsSUFBSTBDLEVBQVliLEtBQUtFLE1BQXNCLEdBQWhCRixLQUFLQyxVQUM1QmEsRUFBWWQsS0FBS0UsTUFBc0IsR0FBaEJGLEtBQUtDLFVBRWhDLEdBQ3lELE1BQXJEL0MsRUFBT0QsVUFBVUEsVUFBVTRELEdBQVdDLElBQ3FCLE1BQTNENUQsRUFBT0QsVUFBVUEsVUFBVTRELEdBQVdDLEdBQVdoRCxPQUNJLE1BQXJEWixFQUFPRCxVQUFVQSxVQUFVNEQsR0FBV0MsR0FHdEMsT0FEQTVELEVBQU9ELFVBQVVtQyxjQUFjeUIsRUFBV0MsR0FDc0IsaUJBQXJENUQsRUFBT0QsVUFBVUEsVUFBVTRELEdBQVdDLElBQzdDNUQsRUFBT0QsVUFBVUEsVUFBVTRELEdBQVdDLEdBQWE1RCxFQUFPRCxVQUFVQSxVQUFVNEQsR0FBV0MsR0FBV2hELE1BQ3BHaUQsV0FBV0osRUFBTyxVQUNsQkwsVUFHQUEsSUFJSkssRUFBT0MsRUFBVSxFQUV6QixFQU9KLENDb0JzQkksQ0FBc0J0QixFQUFZRixHRGxCeEQsU0FBOEJ0QyxFQUFRaUQsR0FDbEMsTUFBTUMsRUFBWTlCLFNBQVMrQixjQUFjLE9BQ3pDRCxFQUFVMUIsVUFBVUMsSUFBSSxhQUN4QixJQUFLLElBQUl2QixFQUFJLEVBQUdBLEVBQUlGLEVBQU9ELFVBQVVBLFVBQVVMLE9BQVFRLElBQ25ELElBQUssSUFBSUMsRUFBSSxFQUFHQSxFQUFJSCxFQUFPRCxVQUFVQSxVQUFVRyxHQUFHUixPQUFRUyxJQUFLLENBQzNELE1BQU1rRCxFQUFTakMsU0FBUytCLGNBQWMsT0FTdENELEVBQVVLLFlBQVlGLEdBQ3RCQSxFQUFPOUIsaUJBQWlCLFNBQVMsS0FDN0J2QixFQUFPRCxVQUFVbUMsY0FBYyxDQUFDaEMsR0FBRyxDQUFDQyxJQUNZLGlCQUF0Q0gsRUFBT0QsVUFBVUEsVUFBVUcsR0FBR0MsSUFDcENrRCxFQUFPQyxVQUFZdEQsRUFBT0QsVUFBVUEsVUFBVUcsR0FBR0MsR0FBR1MsTUFDcER5QyxFQUFPN0IsVUFBVUMsSUFBSSxZQUVyQjRCLEVBQU9DLFVBQVl0RCxFQUFPRCxVQUFVQSxVQUFVRyxHQUFHQyxHQUNqRDBELFdBQVd4QixFQUFnQm9CLE9BQU8sS0FDbENwQixFQUFnQmUsU0FDcEIsR0FFUixDQUVKSCxFQUFJTyxPQUFPTixFQUNmLENDVklhLENBQW9CdEIsRUFBWUYsR0FFaENGLEVBQWdCZSxRQUVwQixDQ3RGSVksRUFBUyxHIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9zaGlwLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvcGxheWVyLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZ2FtZWJvYXJkLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvVUkuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9nYW1lLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgU2hpcCA9IChzaGlwTGVuZ3RoKSA9PiB7XG4gIGNvbnN0IGxlbmd0aCA9IHNoaXBMZW5ndGg7XG4gIGxldCBoaXRzID0gMDtcblxuICBmdW5jdGlvbiBoaXQoKSB7XG4gICAgaGl0cyArPSAxO1xuICB9XG5cbiAgZnVuY3Rpb24gaXNTdW5rKCkge1xuICAgIGlmIChzaGlwTGVuZ3RoIDw9IGhpdHMpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gZWxzZSByZXR1cm4gZmFsc2U7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIGhpdCxcbiAgICBpc1N1bmssXG4gICAgbGVuZ3RoLFxuICAgIGdldEhpdHM6ICgpID0+IGhpdHMsXG4gIH07XG59O1xuXG5leHBvcnQgeyBTaGlwIH07XG4iLCJpbXBvcnQgeyBHYW1lYm9hcmQgfSBmcm9tIFwiLi9nYW1lYm9hcmRcIlxyXG5cclxuY29uc3QgUGxheWVyID0gKHBsYXllcnR5cGUpID0+IHtcclxuICAgIGNvbnN0IHR5cGUgPSBwbGF5ZXJ0eXBlO1xyXG5cclxuICAgIGNvbnN0IGdhbWVib2FyZCA9IEdhbWVib2FyZChwbGF5ZXJ0eXBlKTtcclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIHR5cGUsXHJcbiAgICAgICAgZ2FtZWJvYXJkXHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCB7UGxheWVyfVxyXG4iLCJpbXBvcnQgeyBTaGlwIH0gZnJvbSBcIi4vc2hpcFwiO1xuaW1wb3J0IHsgbW9kYWwgfSBmcm9tIFwiLi9VSVwiO1xuXG5jb25zdCBHYW1lYm9hcmQgPSAocGxheWVyKSA9PiB7XG4gIGZ1bmN0aW9uIGNyZWF0ZUdhbWVCb2FyZCgpIHtcbiAgICBjb25zdCBnYW1lQm9hcmQgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8PSA5OyBpKyspIHtcbiAgICAgIGdhbWVCb2FyZFtpXSA9IFtdO1xuICAgICAgZm9yIChsZXQgaiA9IDA7IGogPD0gOTsgaisrKSB7XG4gICAgICAgIGdhbWVCb2FyZFtpXVtqXSA9IFwiXCI7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBnYW1lQm9hcmQ7XG4gIH1cblxuICBjb25zdCBnYW1lYm9hcmQgPSBjcmVhdGVHYW1lQm9hcmQoKTtcbiAgY29uc3Qgc2hpcHMgPSBbXTtcblxuICBmdW5jdGlvbiBfaXNXaXRoaW5Cb3VuZHMoaW5kZXgpIHtcbiAgICBpZiAoaW5kZXggPCAwIHx8IGluZGV4ID4gOSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICAvL3N0YXJ0IGFuZCBlbmQgaGVyZSAtIGluZGV4ZXMgb2YgdGhlIGJvcmQncyBjZWxscyB3aGVyZSBpIHdhbnQgdG8gcGxhY2Ugc2hpcFxuICAvLyB0aGUgY29vcmRpbmF0ZSBvYmplY3Qgc2hvdWxkIGhhdmUgYSByZWZlcmVuY2UgdG8gdGhlIHNoaXAgaW4gaXRzIGxvY2F0aW9uLlxuICBmdW5jdGlvbiBwbGFjZVNoaXAoY29sLCByb3csIHNoaXAsIGRpcmVjdGlvbikge1xuICAgIGlmIChfaXNXaXRoaW5Cb3VuZHMoY29sKSAmJiBfaXNXaXRoaW5Cb3VuZHMocm93KSAmJiAhX2NoZWNrQ2VsbHNBcm91bmQoY29sLCByb3cpKSB7XG4gICAgICAgIGlmIChkaXJlY3Rpb24gPT09IFwidmVydGljYWxcIiAmJiBfaXNXaXRoaW5Cb3VuZHMoY29sICsgc2hpcC5sZW5ndGggLSAxKSYmIV9jaGVja0NlbGxzQXJvdW5kKGNvbCArIHNoaXAubGVuZ3RoIC0gMSwgcm93KSkge1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IGNvbDsgaSA8IGNvbCArIHNoaXAubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBpZiAoZ2FtZWJvYXJkW2ldW3Jvd10gPT09IFwiXCIgKSB7XG4gICAgICAgICAgICAgICAgICAgIGdhbWVib2FyZFtpXVtyb3ddID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogYCR7c2hpcC5sZW5ndGh9c2hpcGAsXG4gICAgICAgICAgICAgICAgICAgICAgICBzaGlwOiBzaGlwLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IFwiT1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNTdW5rOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgc2hpcHMucHVzaChnYW1lYm9hcmRbaV1bcm93XSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHJldHVybiAyOyBcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChkaXJlY3Rpb24gPT09IFwiaG9yaXpvbnRhbFwiICYmIF9pc1dpdGhpbkJvdW5kcyhyb3cgKyBzaGlwLmxlbmd0aCAtIDEpJiYhX2NoZWNrQ2VsbHNBcm91bmQoY29sLCByb3cgKyBzaGlwLmxlbmd0aCAtIDEpKSB7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gcm93OyBpIDwgcm93ICsgc2hpcC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGlmIChnYW1lYm9hcmRbY29sXVtpXSA9PT0gXCJcIikge1xuICAgICAgICAgICAgICAgICAgICBnYW1lYm9hcmRbY29sXVtpXSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IGAke3NoaXAubGVuZ3RofXNoaXBgLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2hpcDogc2hpcCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBcIk9cIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzU3VuazogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIHNoaXBzLnB1c2goZ2FtZWJvYXJkW2NvbF1baV0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSByZXR1cm4gMjsgXG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSByZXR1cm4gMjsgXG4gICAgfSBlbHNlIHJldHVybiAyOyBcblxuICAgIHJldHVybiBnYW1lYm9hcmQ7XG59XG5cbiAgXG5cbiAgLy9DdXJyZW50bHkgdGVzdGluZyB0aGlzIGluIGluZGV4LmpzXG4gIGZ1bmN0aW9uIHJlY2VpdmVBdHRhY2soY29sLCByb3cpIHtcbiAgICBpZiAoX2lzV2l0aGluQm91bmRzKGNvbCkgJiYgX2lzV2l0aGluQm91bmRzKHJvdykmJmNoZWNrRW5kR2FtZSgpICE9PSB0cnVlKSB7XG4gICAgICBsZXQgYm9hcmRDZWxsID0gZ2FtZWJvYXJkW2NvbF1bcm93XTtcbiAgICAgIGlmIChib2FyZENlbGwgPT09ICdcXHUyNUNGJykge1xuICAgICAgICByZXR1cm47XG4gICAgICB9IGVsc2UgaWYgKGJvYXJkQ2VsbCA9PT0gXCJcIikge1xuICAgICAgICBnYW1lYm9hcmRbY29sXVtyb3ddID0gJ1xcdTI1Q0YnO1xuICAgICAgICBjb25zb2xlLmxvZyhcIk1pc3NcIik7XG4gICAgICB9IGVsc2UgaWYgKGJvYXJkQ2VsbC52YWx1ZSA9PT0gXCJPXCIpIHtcbiAgICAgICAgYm9hcmRDZWxsLnNoaXAuaGl0KCk7XG4gICAgICAgIGJvYXJkQ2VsbC52YWx1ZSA9IFwiWFwiO1xuICAgICAgICBpZiAoYm9hcmRDZWxsLnNoaXAuaXNTdW5rKCkpIHtcbiAgICAgICAgICBib2FyZENlbGwuaXNTdW5rID0gdHJ1ZTtcbiAgICAgICAgICAvLyBfbWFya0NlbGxzQXJvdW5kU3VjY3Nlc3NmdWxsSGl0KGNvbCwgcm93KTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIlN1bmtcIik7XG4gICAgICAgIH1cbiAgICAgICAgY29uc29sZS5sb2coYm9hcmRDZWxsLmlzU3Vuayk7XG4gICAgICAgIGNoZWNrRW5kR2FtZSgpXG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBjb25zb2xlLmxvZyhcIkF0dGFjayBvdXQgb2YgYm9hcmRcIik7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gX2NoZWNrQ2VsbHNBcm91bmQoY29sLCByb3cpIHtcbiAgICBjb25zdCBuZWlnaGJvdXJzID0gW1xuICAgICAgZ2FtZWJvYXJkW2NvbCArIDFdPy5bcm93XSxcbiAgICAgIGdhbWVib2FyZFtjb2wgLSAxXT8uW3Jvd10sXG4gICAgICBnYW1lYm9hcmRbY29sXT8uW3JvdyArIDFdLFxuICAgICAgZ2FtZWJvYXJkW2NvbF0/Lltyb3cgLSAxXSxcbiAgICAgIGdhbWVib2FyZFtjb2wgKyAxXT8uW3JvdyArIDFdLFxuICAgICAgZ2FtZWJvYXJkW2NvbCAtIDFdPy5bcm93IC0gMV0sXG4gICAgICBnYW1lYm9hcmRbY29sIC0gMV0/Lltyb3cgKyAxXSxcbiAgICAgIGdhbWVib2FyZFtjb2wgKyAxXT8uW3JvdyAtIDFdLFxuICAgIF07XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5laWdoYm91cnMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmIChuZWlnaGJvdXJzW2ldICYmIG5laWdoYm91cnNbaV0udmFsdWUgPT09IFwiT1wiKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfSBcbiAgcmV0dXJuIGZhbHNlXG59XG5cbiAgZnVuY3Rpb24gX21hcmtDZWxsc0Fyb3VuZFN1Y2NzZXNzZnVsbEhpdChjb2wsIHJvdykge1xuICAgIGNvbnN0IG5laWdoYm91cnMgPSBbXG4gICAgICBnYW1lYm9hcmRbY29sICsgMV0/Lltyb3ddLFxuICAgICAgZ2FtZWJvYXJkW2NvbCAtIDFdPy5bcm93XSxcbiAgICAgIGdhbWVib2FyZFtjb2xdPy5bcm93ICsgMV0sXG4gICAgICBnYW1lYm9hcmRbY29sXT8uW3JvdyAtIDFdLFxuICAgICAgZ2FtZWJvYXJkW2NvbCArIDFdPy5bcm93ICsgMV0sXG4gICAgICBnYW1lYm9hcmRbY29sIC0gMV0/Lltyb3cgLSAxXSxcbiAgICAgIGdhbWVib2FyZFtjb2wgLSAxXT8uW3JvdyArIDFdLFxuICAgICAgZ2FtZWJvYXJkW2NvbCArIDFdPy5bcm93IC0gMV0sXG4gICAgXTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbmVpZ2hib3Vycy5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKFxuICAgICAgICBuZWlnaGJvdXJzW2ldICE9PSB1bmRlZmluZWQgJiZcbiAgICAgICAgbmVpZ2hib3Vyc1tpXS52YWx1ZSAhPT0gXCJPXCIgJiZcbiAgICAgICAgbmVpZ2hib3Vyc1tpXS52YWx1ZSAhPT0gXCJYXCJcbiAgICAgICkge1xuICAgICAgICBuZWlnaGJvdXJzW2ldID0gJ1xcdTI1Q0YnO1xuICAgICAgICAvLyBVcGRhdGUgY29ycmVzcG9uZGluZyB2YWx1ZSBpbiBnYW1lYm9hcmQgYXJyYXlcbiAgICAgICAgc3dpdGNoIChpKSB7XG4gICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgZ2FtZWJvYXJkW2NvbCArIDFdW3Jvd10gPSAnXFx1MjVDRic7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICBnYW1lYm9hcmRbY29sIC0gMV1bcm93XSA9ICdcXHUyNUNGJztcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgIGdhbWVib2FyZFtjb2xdW3JvdyArIDFdID0gJ1xcdTI1Q0YnO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgZ2FtZWJvYXJkW2NvbF1bcm93IC0gMV0gPSAnXFx1MjVDRic7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIDQ6XG4gICAgICAgICAgICBnYW1lYm9hcmRbY29sICsgMV1bcm93ICsgMV0gPSAnXFx1MjVDRic7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIDU6XG4gICAgICAgICAgICBnYW1lYm9hcmRbY29sIC0gMV1bcm93IC0gMV0gPSAnXFx1MjVDRic7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIDY6XG4gICAgICAgICAgICBnYW1lYm9hcmRbY29sIC0gMV1bcm93ICsgMV0gPSAnXFx1MjVDRic7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIDc6XG4gICAgICAgICAgICBnYW1lYm9hcmRbY29sICsgMV1bcm93IC0gMV0gPSAnXFx1MjVDRic7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBjaGVja0VuZEdhbWUoKSB7XG4gICAgbGV0IGNvdW50ZXIgPSAwO1xuICAgIGZvciAobGV0IHNoaXAgb2Ygc2hpcHMpIHtcbiAgICAgIGlmIChzaGlwLmlzU3VuayA9PT0gdHJ1ZSkge1xuICAgICAgICBjb3VudGVyKys7XG4gICAgICB9XG4gICAgfVxuICAgIGNvbnNvbGUubG9nKGNvdW50ZXIpO1xuICAgIGlmIChjb3VudGVyID49IDEwKSB7XG4gICAgICBsZXQgbmV3cz0gbW9kYWwoYCR7cGxheWVyfWApO1xuICAgICAgbmV3cy5vcGVuTW9kYWwoKVxuICAgICAgY29uc29sZS5sb2coYCR7cGxheWVyfSBsb3NlYCk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4ge1xuICAgIGdhbWVib2FyZCxcbiAgICBwbGFjZVNoaXAsXG4gICAgcmVjZWl2ZUF0dGFjayxcbiAgICBjaGVja0VuZEdhbWUsXG4gIH07XG59O1xuXG5leHBvcnQgeyBHYW1lYm9hcmQgfVxuIiwiaW1wb3J0IHsgcGxheWVyR2FtZWJvYXJkIH0gZnJvbSBcIi4vZ2FtZVwiO1xyXG5cclxuZnVuY3Rpb24gcmVuZGVyUGxheWVyR2FtZWJvYXJkKHBsYXllciwgYm94KSB7XHJcbiAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdjb250YWluZXInKVxyXG4gICAgZnVuY3Rpb24gcmVuZGVyKCkgeyAgIFxyXG4gICAgICAgIGNvbnRhaW5lci50ZXh0Q29udGVudCA9ICcnOyBcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHBsYXllci5nYW1lYm9hcmQuZ2FtZWJvYXJkLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgcGxheWVyLmdhbWVib2FyZC5nYW1lYm9hcmRbaV0ubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHNxdWFyZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgICAgICAgaWYodHlwZW9mKHBsYXllci5nYW1lYm9hcmQuZ2FtZWJvYXJkW2ldW2pdKSA9PT0gJ29iamVjdCcpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZihwbGF5ZXIuZ2FtZWJvYXJkLmdhbWVib2FyZFtpXVtqXS52YWx1ZSA9ICdPJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzcXVhcmUuaW5uZXJIVE1MID0gcGxheWVyLmdhbWVib2FyZC5nYW1lYm9hcmRbaV1bal0udmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNxdWFyZS5jbGFzc0xpc3QuYWRkKCdibGFjaycpXHJcbiAgICAgICAgICAgICAgICAgICAgfSBcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocGxheWVyLmdhbWVib2FyZC5nYW1lYm9hcmRbaV1bal0gPT09IFwiWFwiKXtcclxuICAgICAgICAgICAgICAgICAgICBzcXVhcmUuaW5uZXJIVE1MID0gcGxheWVyLmdhbWVib2FyZC5nYW1lYm9hcmRbaV1bal07IFxyXG4gICAgICAgICAgICAgICAgICAgIHNxdWFyZS5jbGFzc0xpc3QuYWRkKCdvcmFuZ2UnKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3F1YXJlLmlubmVySFRNTCA9IHBsYXllci5nYW1lYm9hcmQuZ2FtZWJvYXJkW2ldW2pdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHNxdWFyZSk7XHJcbiAgICAgICAgICAgIH0gICBcclxuICAgICAgICB9XHJcbiAgICAgICAgYm94LmFwcGVuZChjb250YWluZXIpXHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgTUFYX0FUVEVNUFRTID0gOTk7XHJcblxyXG4gICAgZnVuY3Rpb24gYXR0YWNrKGF0dGVtcHQgPSAwKSB7XHJcbiAgICAgICAgaWYgKGF0dGVtcHQgPj0gTUFYX0FUVEVNUFRTKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiTWF4aW11bSBhdHRlbXB0cyByZWFjaGVkLiBFeGl0aW5nIGF0dGFjayBmdW5jdGlvbi5cIik7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgbGV0IGNvbFJhbmRvbSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcclxuICAgICAgICBsZXQgcm93UmFuZG9tID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApO1xyXG4gICAgXHJcbiAgICAgICAgaWYgKFxyXG4gICAgICAgICAgICBwbGF5ZXIuZ2FtZWJvYXJkLmdhbWVib2FyZFtjb2xSYW5kb21dW3Jvd1JhbmRvbV0gIT09ICdcXHUyNUNGJyAmJlxyXG4gICAgICAgICAgICBwbGF5ZXIuZ2FtZWJvYXJkLmdhbWVib2FyZFtjb2xSYW5kb21dW3Jvd1JhbmRvbV0udmFsdWUgIT09ICdYJyAmJlxyXG4gICAgICAgICAgICBwbGF5ZXIuZ2FtZWJvYXJkLmdhbWVib2FyZFtjb2xSYW5kb21dW3Jvd1JhbmRvbV0gIT09ICdYJ1xyXG4gICAgICAgICkge1xyXG4gICAgICAgICAgICBwbGF5ZXIuZ2FtZWJvYXJkLnJlY2VpdmVBdHRhY2soY29sUmFuZG9tLCByb3dSYW5kb20pO1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIHBsYXllci5nYW1lYm9hcmQuZ2FtZWJvYXJkW2NvbFJhbmRvbV1bcm93UmFuZG9tXSA9PT0gJ29iamVjdCcpIHtcclxuICAgICAgICAgICAgICAgIHBsYXllci5nYW1lYm9hcmQuZ2FtZWJvYXJkW2NvbFJhbmRvbV1bcm93UmFuZG9tXSA9IHBsYXllci5nYW1lYm9hcmQuZ2FtZWJvYXJkW2NvbFJhbmRvbV1bcm93UmFuZG9tXS52YWx1ZTtcclxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoYXR0YWNrLDEwMDApXHJcbiAgICAgICAgICAgICAgICByZW5kZXIoKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJlbmRlcigpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgYXR0YWNrKGF0dGVtcHQgKyAxKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgcmVuZGVyLFxyXG4gICAgICAgIGF0dGFja1xyXG4gICAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiByZW5kZXJDb21wR2FtZWJvYXJkIChwbGF5ZXIsIGJveCkge1xyXG4gICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICBjb250YWluZXIuY2xhc3NMaXN0LmFkZCgnY29udGFpbmVyJylcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGxheWVyLmdhbWVib2FyZC5nYW1lYm9hcmQubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHBsYXllci5nYW1lYm9hcmQuZ2FtZWJvYXJkW2ldLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHNxdWFyZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgICAvL0NvbWVudGVkIGZvciBjaGVja2luZyByYW5kb20gc2hpcCBwbGFjZW1lbnQgb24gY29tcCBib2FyZFxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gaWYodHlwZW9mKHBsYXllci5nYW1lYm9hcmQuZ2FtZWJvYXJkW2ldW2pdKSA9PT0gJ29iamVjdCcpIHtcclxuICAgICAgICAgICAgLy8gICAgIGlmKHBsYXllci5nYW1lYm9hcmQuZ2FtZWJvYXJkW2ldW2pdLnZhbHVlID0gJ08nKSB7XHJcbiAgICAgICAgICAgIC8vICAgICAgICAgc3F1YXJlLmlubmVySFRNTCA9IHBsYXllci5nYW1lYm9hcmQuZ2FtZWJvYXJkW2ldW2pdLnZhbHVlO1xyXG4gICAgICAgICAgICAvLyAgICAgICAgIHNxdWFyZS5jbGFzc0xpc3QuYWRkKCdibGFjaycpXHJcbiAgICAgICAgICAgIC8vICAgICB9IFxyXG4gICAgICAgICAgICAvLyB9IFxyXG4gICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoc3F1YXJlKTtcclxuICAgICAgICAgICAgc3F1YXJlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcGxheWVyLmdhbWVib2FyZC5yZWNlaXZlQXR0YWNrKFtpXSxbal0pXHJcbiAgICAgICAgICAgICAgICBpZih0eXBlb2YocGxheWVyLmdhbWVib2FyZC5nYW1lYm9hcmRbaV1bal0pID09PSAnb2JqZWN0Jykge1xyXG4gICAgICAgICAgICAgICAgICAgIHNxdWFyZS5pbm5lckhUTUwgPSBwbGF5ZXIuZ2FtZWJvYXJkLmdhbWVib2FyZFtpXVtqXS52YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICBzcXVhcmUuY2xhc3NMaXN0LmFkZCgnb3JhbmdlJyk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHNxdWFyZS5pbm5lckhUTUwgPSBwbGF5ZXIuZ2FtZWJvYXJkLmdhbWVib2FyZFtpXVtqXTtcclxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KHBsYXllckdhbWVib2FyZC5hdHRhY2ssMTAwMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcGxheWVyR2FtZWJvYXJkLnJlbmRlcigpXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgYm94LmFwcGVuZChjb250YWluZXIpO1xyXG59XHJcblxyXG5jb25zdCBtb2RhbCA9IChsb3NlcikgPT4ge1xyXG4gICAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsXCIpO1xyXG4gICAgY29uc3Qgb3ZlcmxheSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIub3ZlcmxheVwiKTtcclxuICAgIGNvbnN0IG5ld0dhbWVCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmJ0blwiKTtcclxuICAgIG5ld0dhbWVCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgICAgICAgY2xvc2VNb2RhbCgpXHJcbiAgICB9KVxyXG5cclxuXHJcbiAgICBmdW5jdGlvbiBvcGVuTW9kYWwoKSB7XHJcbiAgICAgICAgY29uc3Qgd2luTWFzc2FnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy53aW4nKTtcclxuICAgICAgICB3aW5NYXNzYWdlLnRleHRDb250ZW50ID0gYCR7bG9zZXJ9IGxvc3QhYFxyXG4gICAgICAgIG1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoXCJoaWRkZW5cIik7XHJcbiAgICAgICAgb3ZlcmxheS5jbGFzc0xpc3QucmVtb3ZlKFwiaGlkZGVuXCIpO1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgZnVuY3Rpb24gY2xvc2VNb2RhbCgpIHtcclxuICAgICAgICBtb2RhbC5jbGFzc0xpc3QuYWRkKFwiaGlkZGVuXCIpO1xyXG4gICAgICAgIG92ZXJsYXkuY2xhc3NMaXN0LmFkZChcImhpZGRlblwiKTtcclxuICAgICAgICBsb2NhdGlvbi5yZWxvYWQoKVxyXG4gICAgfTtcclxuXHJcbiAgICByZXR1cm4ge29wZW5Nb2RhbH1cclxufVxyXG5cclxuXHJcblxyXG5cclxuZXhwb3J0IHtcclxuICAgIHJlbmRlclBsYXllckdhbWVib2FyZCxcclxuICAgIHJlbmRlckNvbXBHYW1lYm9hcmQsXHJcbiAgICBtb2RhbFxyXG59IiwiaW1wb3J0IHsgU2hpcCB9IGZyb20gXCIuL3NoaXBcIjtcclxuaW1wb3J0IHsgUGxheWVyIH0gZnJvbSBcIi4vcGxheWVyXCI7XHJcbmltcG9ydCB7IHJlbmRlclBsYXllckdhbWVib2FyZCwgcmVuZGVyQ29tcEdhbWVib2FyZCB9IGZyb20gXCIuL1VJXCI7XHJcblxyXG5sZXQgcGxheWVyR2FtZWJvYXJkXHJcbmZ1bmN0aW9uIHBsYXlHYW1lICgpIHsgXHJcbiAgICBjb25zdCBwbGF5ZXJCb2FyZEJveCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5nYW1lYm9hcmQtb25lJyk7XHJcbiAgICBjb25zdCBjb21wdXRlckJvYXJkQm94ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmdhbWVib2FyZC10d28nKTtcclxuXHJcbiAgICBjb25zdCByZWFsUGxheWVyID0gUGxheWVyKCdZb3UnKTtcclxuICAgIGNvbnN0IGNvbXBQbGF5ZXIgPSBQbGF5ZXIoJ0NvbXB1dGVyJyk7XHJcblxyXG4gICAgY29uc3QgZm91clNoaXAgPSBTaGlwKDQpXHJcbiAgICBjb25zdCB0aHJlZVNoaXBPbmUgPSBTaGlwKDMpO1xyXG4gICAgY29uc3QgdGhyZWVTaGlwVHdvID0gU2hpcCgzKTtcclxuICAgIGNvbnN0IHR3b1NoaXBPbmUgPSBTaGlwKDIpO1xyXG4gICAgY29uc3QgdHdvU2hpcFR3byA9IFNoaXAoMik7XHJcbiAgICBjb25zdCB0d29TaGlwVGhyZWUgPSBTaGlwKDIpO1xyXG4gICAgY29uc3Qgb25lU2hpcE9uZSA9IFNoaXAoMSk7XHJcbiAgICBjb25zdCBvbmVTaGlwVHdvID0gU2hpcCgxKTtcclxuICAgIGNvbnN0IG9uZVNoaXBUaHJlZSA9IFNoaXAoMSk7XHJcbiAgICBjb25zdCBvbmVTaGlwRm91ciA9IFNoaXAoMSk7XHJcblxyXG4gICAgY29uc3Qgc2hpcHMgPSBbZm91clNoaXAsIHRocmVlU2hpcE9uZSwgdGhyZWVTaGlwVHdvLCB0d29TaGlwT25lLHR3b1NoaXBUd28sIHR3b1NoaXBUaHJlZSwgb25lU2hpcE9uZSwgb25lU2hpcFR3bywgb25lU2hpcFRocmVlLCBvbmVTaGlwRm91cl1cclxuXHJcbiAgICBmdW5jdGlvbiBnZXRSYW5kb21TdHJpbmcoc3RyaW5nMSwgc3RyaW5nMikge1xyXG4gICAgICAgIHJldHVybiBNYXRoLnJhbmRvbSgpIDwgMC41ID8gc3RyaW5nMSA6IHN0cmluZzI7XHJcbiAgICB9XHJcbiAgICAvLyBmdW5jdGlvbiByZW5kZXJTaGlwKGdhbWVib2FyZCwgY29sLCByb3cpIHtcclxuICAgIC8vICAgICBjb25zdCBob3Jpem9udGFsID0gJ2hvcml6b250YWwnO1xyXG4gICAgLy8gICAgIGNvbnN0IHZlcnRpY2FsID0gJ3ZlcnRpY2FsJztcclxuICAgIC8vICAgICBsZXQgb3JpZW50YXRpb24gPSBnZXRSYW5kb21TdHJpbmcoaG9yaXpvbnRhbCx2ZXJ0aWNhbClcclxuICAgIC8vICAgICBzaGlwcy5mb3JFYWNoKChzaGlwKT0+IHtcclxuICAgIC8vICAgICAgICAgZ2FtZWJvYXJkLmdhbWVib2FyZC5wbGFjZVNoaXAoY29sLCByb3csIHNoaXAsIG9yaWVudGF0aW9uKVxyXG4gICAgLy8gICAgIH0pXHJcbiAgICAvLyB9XHJcblxyXG4gICAgLy9SZW5kZXJzIGFsbCBzaGlwcyBidXQgdGhlIHNoaXBzIHRvdWNoIGVhY2ggb3RoZXIgb24gdGhlIGJvYXJkIFxyXG4gICAgLy9OZWVkIHRvIHVwZGF0ZSBwbGFjZVNoaXBcclxuICAgIGZ1bmN0aW9uIHJlbmRlclNoaXAoZ2FtZWJvYXJkKSB7XHJcbiAgICAgICAgY29uc3QgaG9yaXpvbnRhbCA9ICdob3Jpem9udGFsJztcclxuICAgICAgICBjb25zdCB2ZXJ0aWNhbCA9ICd2ZXJ0aWNhbCc7XHJcbiAgICAgICAgXHJcbiAgICBcclxuICAgICAgICBzaGlwcy5mb3JFYWNoKChzaGlwKSA9PiB7XHJcbiAgICAgICAgICAgIGxldCBzaGlwUGxhY2VkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHdoaWxlICghc2hpcFBsYWNlZCkge1xyXG4gICAgICAgICAgICAgICAgbGV0IG9yaWVudGF0aW9uID0gZ2V0UmFuZG9tU3RyaW5nKGhvcml6b250YWwsIHZlcnRpY2FsKTtcclxuICAgICAgICAgICAgICAgIGxldCBjb2wgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7IFxyXG4gICAgICAgICAgICAgICAgbGV0IHJvdyA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTsgXHJcbiAgICAgICAgICAgICAgICBsZXQgcmVzdWx0ID0gZ2FtZWJvYXJkLmdhbWVib2FyZC5wbGFjZVNoaXAoY29sLCByb3csIHNoaXAsIG9yaWVudGF0aW9uKTtcclxuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgIT09IDIpIHtcclxuICAgICAgICAgICAgICAgICAgICBzaGlwUGxhY2VkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgXHJcblxyXG4gICAgcmVuZGVyU2hpcChyZWFsUGxheWVyKTtcclxuICAgIHJlbmRlclNoaXAoY29tcFBsYXllcilcclxuICAgIC8vIHJlYWxQbGF5ZXIuZ2FtZWJvYXJkLnBsYWNlU2hpcCgwLDAsIGZvdXJTaGlwLCAnaG9yaXpvbnRhbCcpO1xyXG4gICAgLy8gcmVhbFBsYXllci5nYW1lYm9hcmQucGxhY2VTaGlwKDksNiwgdGhyZWVTaGlwT25lLCAnaG9yaXpvbnRhbCcpO1xyXG4gICAgLy8gcmVhbFBsYXllci5nYW1lYm9hcmQucGxhY2VTaGlwKDAsOSwgdGhyZWVTaGlwVHdvLCAndmVydGljYWwnKTtcclxuICAgIC8vIHJlYWxQbGF5ZXIuZ2FtZWJvYXJkLnBsYWNlU2hpcCg4LDAsIHR3b1NoaXBPbmUsICdob3Jpem9udGFsJyk7XHJcbiAgICAvLyByZWFsUGxheWVyLmdhbWVib2FyZC5wbGFjZVNoaXAoNSw0LCB0d29TaGlwVHdvLCAndmVydGljYWwnKTtcclxuICAgIC8vIHJlYWxQbGF5ZXIuZ2FtZWJvYXJkLnBsYWNlU2hpcCgyLDYsIHR3b1NoaXBUaHJlZSwgJ2hvcml6b250YWwnKTtcclxuICAgIC8vIHJlYWxQbGF5ZXIuZ2FtZWJvYXJkLnBsYWNlU2hpcCg4LDQsIG9uZVNoaXBPbmUsICdob3Jpem9udGFsJyk7XHJcbiAgICAvLyByZWFsUGxheWVyLmdhbWVib2FyZC5wbGFjZVNoaXAoMiwyLCBvbmVTaGlwVHdvLCAnaG9yaXpvbnRhbCcpO1xyXG4gICAgLy8gcmVhbFBsYXllci5nYW1lYm9hcmQucGxhY2VTaGlwKDYsOCwgb25lU2hpcFRocmVlLCAnaG9yaXpvbnRhbCcpO1xyXG4gICAgLy8gcmVhbFBsYXllci5nYW1lYm9hcmQucGxhY2VTaGlwKDUsMCwgb25lU2hpcEZvdXIsICdob3Jpem9udGFsJyk7XHJcblxyXG4gICAgLy8gY29tcFBsYXllci5nYW1lYm9hcmQucGxhY2VTaGlwKDAsMCwgZm91clNoaXAsICdob3Jpem9udGFsJyk7XHJcbiAgICAvLyBjb21wUGxheWVyLmdhbWVib2FyZC5wbGFjZVNoaXAoOSw2LCB0aHJlZVNoaXBPbmUsICdob3Jpem9udGFsJyk7XHJcbiAgICAvLyBjb21wUGxheWVyLmdhbWVib2FyZC5wbGFjZVNoaXAoMCw5LCB0aHJlZVNoaXBUd28sICd2ZXJ0aWNhbCcpO1xyXG4gICAgLy8gY29tcFBsYXllci5nYW1lYm9hcmQucGxhY2VTaGlwKDgsMCwgdHdvU2hpcE9uZSwgJ2hvcml6b250YWwnKTtcclxuICAgIC8vIGNvbXBQbGF5ZXIuZ2FtZWJvYXJkLnBsYWNlU2hpcCg1LDQsIHR3b1NoaXBUd28sICd2ZXJ0aWNhbCcpO1xyXG4gICAgLy8gY29tcFBsYXllci5nYW1lYm9hcmQucGxhY2VTaGlwKDIsNiwgdHdvU2hpcFRocmVlLCAnaG9yaXpvbnRhbCcpO1xyXG4gICAgLy8gY29tcFBsYXllci5nYW1lYm9hcmQucGxhY2VTaGlwKDgsNCwgb25lU2hpcE9uZSwgJ2hvcml6b250YWwnKTtcclxuICAgIC8vIGNvbXBQbGF5ZXIuZ2FtZWJvYXJkLnBsYWNlU2hpcCgyLDIsIG9uZVNoaXBUd28sICdob3Jpem9udGFsJyk7XHJcbiAgICAvLyBjb21wUGxheWVyLmdhbWVib2FyZC5wbGFjZVNoaXAoNyw4LCBvbmVTaGlwVGhyZWUsICdob3Jpem9udGFsJyk7XHJcbiAgICAvLyBjb21wUGxheWVyLmdhbWVib2FyZC5wbGFjZVNoaXAoNSwwLCBvbmVTaGlwRm91ciwgJ2hvcml6b250YWwnKTtcclxuXHJcblxyXG4gICAgcGxheWVyR2FtZWJvYXJkID0gcmVuZGVyUGxheWVyR2FtZWJvYXJkKHJlYWxQbGF5ZXIsIHBsYXllckJvYXJkQm94KTtcclxuICAgIHJlbmRlckNvbXBHYW1lYm9hcmQoY29tcFBsYXllciwgY29tcHV0ZXJCb2FyZEJveClcclxuXHJcbiAgICBwbGF5ZXJHYW1lYm9hcmQucmVuZGVyKCk7XHJcblxyXG59XHJcblxyXG5cclxuZXhwb3J0IHtcclxuICAgIHBsYXllckdhbWVib2FyZCxcclxuICAgIHBsYXlHYW1lXHJcbn1cclxuIiwiaW1wb3J0IHsgcGxheUdhbWUgfSBmcm9tIFwiLi9nYW1lXCI7XG5cbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoKSA9PiB7XG4gICAgcGxheUdhbWUoKVxufSkiXSwibmFtZXMiOlsiU2hpcCIsInNoaXBMZW5ndGgiLCJoaXRzIiwiaGl0IiwiaXNTdW5rIiwibGVuZ3RoIiwiZ2V0SGl0cyIsIlBsYXllciIsInBsYXllcnR5cGUiLCJ0eXBlIiwiZ2FtZWJvYXJkIiwicGxheWVyIiwiZ2FtZUJvYXJkIiwiaSIsImoiLCJjcmVhdGVHYW1lQm9hcmQiLCJzaGlwcyIsIl9pc1dpdGhpbkJvdW5kcyIsImluZGV4IiwiX2NoZWNrQ2VsbHNBcm91bmQiLCJjb2wiLCJyb3ciLCJuZWlnaGJvdXJzIiwidmFsdWUiLCJjaGVja0VuZEdhbWUiLCJjb3VudGVyIiwic2hpcCIsImNvbnNvbGUiLCJsb2ciLCJsb3NlciIsIm1vZGFsIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwib3ZlcmxheSIsImFkZEV2ZW50TGlzdGVuZXIiLCJjbGFzc0xpc3QiLCJhZGQiLCJsb2NhdGlvbiIsInJlbG9hZCIsIm9wZW5Nb2RhbCIsInRleHRDb250ZW50IiwicmVtb3ZlIiwicGxhY2VTaGlwIiwiZGlyZWN0aW9uIiwicHVzaCIsInJlY2VpdmVBdHRhY2siLCJib2FyZENlbGwiLCJHYW1lYm9hcmQiLCJwbGF5ZXJHYW1lYm9hcmQiLCJwbGF5ZXJCb2FyZEJveCIsImNvbXB1dGVyQm9hcmRCb3giLCJyZWFsUGxheWVyIiwiY29tcFBsYXllciIsInJlbmRlclNoaXAiLCJmb3JFYWNoIiwic2hpcFBsYWNlZCIsIm9yaWVudGF0aW9uIiwiTWF0aCIsInJhbmRvbSIsImZsb29yIiwiYm94IiwiY29udGFpbmVyIiwiY3JlYXRlRWxlbWVudCIsInJlbmRlciIsInNxdWFyZSIsImlubmVySFRNTCIsImFwcGVuZENoaWxkIiwiYXBwZW5kIiwiYXR0YWNrIiwiYXR0ZW1wdCIsImNvbFJhbmRvbSIsInJvd1JhbmRvbSIsInNldFRpbWVvdXQiLCJyZW5kZXJQbGF5ZXJHYW1lYm9hcmQiLCJyZW5kZXJDb21wR2FtZWJvYXJkIiwicGxheUdhbWUiXSwic291cmNlUm9vdCI6IiJ9